<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Faster Django tests &middot; No Title</title><link href=/webfonts/junction.css rel=stylesheet type=text/css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css><link rel=stylesheet href=/css/poole.css><link rel=stylesheet href=/css/lanyon.css><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><link href=/index.xml rel=alternate type=application/rss+xml title="No Title"></head><body><div class=masthead><div class=container><h3 class=masthead-title><a href=/ title=Home>No Title</a>
<small>When I finaly take it upon myself to write, this is what happens!!!</small></h3></div></div><div class="content container"><div class=post><h1>Faster Django tests</h1><span class=post-date>Jun 29, 2013</span><p>Tests in django can quickly get annoyingly slow as you build up more and more tests. Two thing I found that significantly improves performance are:</p><ol><li>Switching the test database to something like sqlite.</li><li>Run test concurrently.</li></ol><p>Both of these can be archived fairly easily.</p><p>##Using different database for testing</p><p>Using sqlite during testing is fairly easy. This is specified in <a href=http://stackoverflow.com/questions/3799061/speeding-up-django-testing>answer 1</a> and <a href=http://stackoverflow.com/questions/3096148/how-to-run-djangos-test-database-only-in-memory>answer 2</a>. Since <code>sqlite</code> is now part of the python standard library you don&rsquo;t need to install any thing new. In your <code>settings.py</code> file add</p><pre><code class=language-python>#Django 1.3 and 1.4:

if 'test' in sys.argv:
    DATABASES['default'] = {'ENGINE': 'django.db.backends.sqlite3'}
</code></pre><p>This significantly increases the performance of tests. According to <code>answer 2</code> django automatically creates the databases in memory if the database used is in <code>sqlite</code>.</p><p>##Running tests concurrently</p><p>I had been looking for a way to do this for quiet a while now. Then recently an <a href=http://coreygoldberg.blogspot.ca/2013/06/python-concurrencytest-running.html>article</a> on <a href=http://pycoders.com/>Pycoder Weekly</a> about running tests concurrently set me on the right track.</p><p>First you will have to install <a href=https://github.com/cgoldberg/concurrencytest>concurrencytest</a>:</p><pre><code class=language-sh>$ pip install concurrencytest
</code></pre><p>Now to customize it for django add this class and related imports in a path that is accessible to django.</p><pre><code class=language-python>from django.test.simple import DjangoTestSuiteRunner
from django.utils import unittest

from concurrencytest import ConcurrentTestSuite, fork_for_tests

class MyTestSuiteRunner(DjangoTestSuiteRunner):
    def run_suite(self, suite, **kwargs):
        return unittest.TextTestRunner(
            verbosity=self.verbosity, failfast=self.failfast).run(
                ConcurrentTestSuite(suite, fork_for_tests(4)))
</code></pre><p>Also update your <code>settings.py</code> file to set this as the <code>test runner</code> like so.</p><pre><code class=language-python>TEST_RUNNER = 'path.to.MyTestSuiteRunner'
</code></pre><p>This has some covets though, each test case should be completely independent of each other. If you have some external file or resource that is shared read and written on to, this could case some of the tests to fail.</p></div></div><footer><link href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet><div class=container><div class=footer-col-wrapper><ul class=social-media-list><li><b>Hittaruki.info</b></li><li><a href=/about/><i class="fa fa-at fa-lg"></i>About</a></li><li><a href=https://github.com/vigneshsarma><i class="fa fa-github-alt fa-lg"></i><span class=username>vigneshsarma</span></a></li><li><a href=https://twitter.com/vigneshsarma><i class="fa fa-twitter fa-lg"></i><span class=username>vigneshsarma</span></a></li><li><a href=https://www.linkedin.com/in/vigneshsarma/><i class="fa fa-linkedin fa-lg"></i></a></li><li><a href=https://www.instagram.com/vigneshsarma><i class="fa fa-instagram fa-lg"></i></a></li><li><a href=/index.xml><i class="fa fa-rss fa-lg"></i></a></li></ul></div></div></footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/clojure-repl.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/clojure.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-34515323-1','auto');ga('send','pageview');</script><script>hljs.initHighlightingOnLoad();</script></body></html>